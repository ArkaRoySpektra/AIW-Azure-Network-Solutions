## Exercise-6 : Monitoring Azure Network

 Duration: 40-45 mins

## Overview

## Task-1 : Enable Network Watcher

### Overview

In this task, you will be enabling Network Watcher. 

1. From the **Home** page of Azure Portal, search for **Network Watcher** from the search box and then click on it.

     ![network watcher](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/networkwatcher.png?raw=true)
     
2. On the overview page of the Network Watcher, you can see the Network Watcher for both primary and secondary regions.

     ![network watcher regions](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/overview.png?raw=true)
     
3. In case, if you don't see the **Network Watcher** for the preferred regions you can follow the below steps.

     - From the **Overview(1)** page of Network Watcher, select **Add(2)**

         ![add net](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/overview1.png?raw=true)

     - In the **Add Network Watcher** blade, 

       - Subscription: From the drpo down select your **Subscription**

       - Region : Choose the region from drop down list and click on it.

       - Click on **Add**

         ![add network watcher](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/addnetwat.png?raw=true)
         
         
   
## Task-2 : Create Flow Logs

### Overview

In this task, you will be creating NSG flow logs.

1. From the **Home** page of Azure Portal, search for **Subscriptions** from the search box and then click on it.

    ![subscription](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/subscription.png?raw=true)
    
2. Now select your **Subscription** from the **Subscriptions** page

    ![subscription1](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/selectsub.png?raw=true)
    
3. Select **Resource providers**, under **Settings** from the options on the left side of the Subscriptions blade.

    ![resource provider](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/rp.png?raw=true)
    
4. Confirm that the status for the **microsoft.insights** provider is **Registered**.

     ![insights](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/insights.png?raw=true)
     
5. Now from **Home** page of Azure Portal, search for **Storage account** from the search box and then click on it

     ![storage](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/storage.png?raw=true)
     
6. In the **Storage account** page, select **Create**.

     ![storage account](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/storageacc.png?raw=true)
     
7.  On the **Basics** tab of **Storage account** blade, enter the below details.

       - Resource Group : **hands-on-lab-<inject key="DeploymentID" enableCopy="true"/>**

       - Storage account name : **storageacc<inject key="DeploymentID" enableCopy="true"/>**

       - Region : **East US**

       - Select **Review + Create**

         ![storage account](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/account.png?raw=true)
         
 8.  Review the configuration of storage account and click on **Create**

      ![create](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/review.png?raw=true)

9. Navigate to the resource group **hands-on-lab-<inject key="DeploymentID" enableCopy="false"/>**, from **Overview(1)** tab select the **NSG-<inject key="DeploymentID" enableCopy="true"/>(2)**.

    ![select nsg](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/selectnsg.png?raw=true)
    
10. Select **NSG flow logs**, under **Monitoring** from the options on the left side of the Network security group blade.

      ![nsg](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/nsgflow.png?raw=true)
      
11. Now click on **Create NSG flow log**

      ![flow log](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/creatensgflow.png?raw=true)
      
12. On the **Basics** tab of **Create a flow log**, enter the following information

      - Network security group : Select **NSG-<inject key="DeploymentID" enableCopy="true"/>** from drop down list

      - Storage accounts: Select **storageacc<inject key="DeploymentID" enableCopy="true"/>** from drop down list.

      - Retention(days) : **7**

      - Select **Review + Create**

        ![flow log](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/flog1.1.png?raw=true)
        
13. Review the configuration of create a flow log and select **Create**

      ![create](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/createflo.png?raw=true)
      
 
14. From **Home** page of Azure Portal, search for **Log Analytics Workspace** from the search box and then click on it

      ![LAW](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/LAW.png?raw=true)
      
15.  Now select **Log Analytics Workspace**

      ![LAW](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/createLAW.png?raw=true)
      
16. On the **Basics** tab of **Create Log Analytics workspace**, enter the below information

       - Resource Group : **hands-on-lab-<inject key="DeploymentID" enableCopy="true"/>**

       - Name : **LogAnalyticsWorkspace**

       - Region : **East US**

       - Select **Review + Create**

       ![create](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/law2.png?raw=true)
       
17. Review the configuration of create analytics workspace and select **Create**

       ![createLAW](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/law2.2.png?raw=true)
       
18. Now search for the **Network Watcher** from Azure Portal's **Home** page and select it.

      ![net](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/network%20watcher.png?raw=true)
      
19. Select **NSG flow logs**, under **Logs** from the options on the left side of the Network Watcher blade.

       ![network watcher](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/logs.png?raw=true)
       
20.  From the **NSG Flow Logs** page, you can observer that you have **Enabled** the **Flow Logs**.

      ![enabled](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/enabled.png?raw=true)


      
